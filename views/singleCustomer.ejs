<%- include('header.ejs'); %>

<% if(accessToken) { %>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <!-- Menu Items -->
    <ul class="navbar-nav mr-auto">
        <li class="nav-item">
          <a class="nav-link" href="/dashboard">Dashboard</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">All Posts</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Admin Users</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Invoices</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/all-data">Customer Entries</a>
        </li>
      </ul>

    <!-- Welcome User Dropdown -->
    <ul class="navbar-nav" style="margin-right: 20px;"> 
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Welcome <%= user.fullname %>
          <img src="<%= user.userphoto %>" alt="Avatar" width="30" height="30" class="rounded-circle">
        </a>
        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
          <a class="dropdown-item" href="/user-profile">My Account</a>
          <a class="dropdown-item" href="/change-password">Change Password</a>
          <div class="dropdown-divider"></div>
          <a class="dropdown-item" href="#" id="logout">Logout</a>
        </div>
      </li>
    </ul>
  </nav>
<div class="container">
        <div class="container emp-profile">
            <form method="post">
                <div class="row">
                    <div class="col-md-4">
                        <div class="profile-img">
                            <img src="" alt=""/>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="profile-head">
                                    <div id="businessName"></div>
                                    <div id="ownerName"></div>
                                    <span id="activeStatus"></span>
                            <ul class="nav nav-tabs" id="myTab" role="tablist">
                                <li class="nav-item">
                                    <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true">About</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile" aria-selected="false">Timeline</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <input type="submit" class="profile-edit-btn" name="btnAddMore" value="Edit Profile"/>
                    </div>
                </div>
                <div class="row">
                    <!-- <div class="col-md-4">
                        <div class="profile-work">
                            <p>WORK LINK</p>
                            <a href="">Website Link</a><br/>
                            <a href="">Bootsnipp Profile</a><br/>
                            <a href="">Bootply Profile</a>
                            <p>SKILLS</p>
                            <a href="">Web Designer</a><br/>
                            <a href="">Web Developer</a><br/>
                            <a href="">WordPress</a><br/>
                            <a href="">WooCommerce</a><br/>
                            <a href="">PHP, .Net</a><br/>
                        </div>
                    </div> -->
                    <div class="col-md-8 details">
                        <div class="tab-content profile-tab" id="myTabContent">
                            <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label>Customer ID</label>
                                            </div>
                                            <div class="col-md-6" id="customeridDIV">
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label>Registration Date</label>
                                            </div>
                                            <div class="col-md-6" id="registrationdateDiv">
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label>Email</label>
                                            </div>
                                            <div class="col-md-6" id="emailDiv">  
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label>Phone</label>
                                            </div>
                                            <div class="col-md-6" id="phoneDiv">
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label>Street Address</label>
                                            </div>
                                            <div class="col-md-6" id="streetaddressDiv">
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label>Suburb</label>
                                            </div>
                                            <div class="col-md-6" id="suburbDiv">
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label>State</label>
                                            </div>
                                            <div class="col-md-6" id="stateDiv">
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label>Country</label>
                                            </div>
                                            <div class="col-md-6" id="countryDiv">
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label>Pincode</label>
                                            </div>
                                            <div class="col-md-6" id="pincodeDiv">
                                            </div>
                                        </div>
                            </div>
                            <div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
                                <div class="row">
                                    <div class="col-md-12" id="extra_infoDiv">
                                     </div>
                                </div>            
                            </div>
                        </div>
                    </div>
                </div>
            </form>           
        </div>
</div><!-- /container -->

<% } %>

<script>
    async function fetchCustomerData() {

        const adminID = '<%= user.userID %>';
        const customer_id = '<%= customerID %>';

        try {
            const response = await fetch(`/api/v1/GetCustomerDetails?adminID=${adminID}&customer_id=${customer_id}`);
            const data = await response.json();
            console.log(data);
            
            // Update the Data dynamically
            const businessNameDiv = document.getElementById('businessName');
            businessNameDiv.innerHTML = `<h5>${data.data.results.business_name}</h5>`;

            // Update the Data dynamically
            const ownerNameDiv = document.getElementById('ownerName');
            ownerNameDiv.innerHTML = `<h6>${data.data.results.customer_name}</h6>`;

            const activeStatusDiv = document.getElementById('activeStatus');
            activeStatusDiv.innerHTML = `<a href="#" class="badge badge-${data.data.results.status === 'Active' ? 'success' : 'danger'}">${data.data.results.status}</a>`

            const customeridDIV = document.getElementById('customeridDIV');
            customeridDIV.innerHTML = `<p>${data.data.results.customer_id}</p>`;

            const registrationdateDiv = document.getElementById('registrationdateDiv');
            registrationdateDiv.innerHTML = `<p>${data.data.results.registration_date}</p>`;

            const emailDiv = document.getElementById('emailDiv');
            emailDiv.innerHTML = `<p>${data.data.results.email}</p>`;

            const phoneDiv = document.getElementById('phoneDiv');
            phoneDiv.innerHTML = `<p>${data.data.results.phone}</p>`;

            const streetaddressDiv = document.getElementById('streetaddressDiv');
            streetaddressDiv.innerHTML = `<p>${data.data.results.street_address}</p>`;

            const suburbDiv = document.getElementById('suburbDiv');
            suburbDiv.innerHTML = `<p>${data.data.results.suburb}</p>`;

            const stateDiv = document.getElementById('stateDiv');
            stateDiv.innerHTML = `<p>${data.data.results.state}</p>`;

            const countryDiv = document.getElementById('countryDiv');
            countryDiv.innerHTML = `<p>${data.data.results.country}</p>`;

            const pincodeDiv = document.getElementById('pincodeDiv');
            pincodeDiv.innerHTML = `<p>${data.data.results.pincode}</p>`;

            const extra_infoDiv = document.getElementById('extra_infoDiv');
            extra_infoDiv.innerHTML = `<p>${data.data.results.extra_info}</p>`;

            const profileImgDiv = document.querySelector('.profile-img img');
            profileImgDiv.src = data.data.results.business_logo;

            
        } catch (error) {
            console.error('Error fetching customer data:', error);
        }
    }

    fetchCustomerData();
</script>